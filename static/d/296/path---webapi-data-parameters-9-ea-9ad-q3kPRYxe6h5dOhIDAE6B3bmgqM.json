{"data":{"site":{"siteMetadata":{"title":"Random thoughts on development and more","author":"Alexander Turiak"}},"markdownRemark":{"id":"2947d454-73e2-51df-9622-f4ee47663cbf","excerpt":"While using Magento 2 checkout API you probably noticed in webapi.xml nodes like this:This feature allows for the API consumers to skip passing current customer…","html":"<p>While using Magento 2 checkout API you probably noticed in <a href=\"https://github.com/magento/magento2/blob/2.3/app/code/Magento/Checkout/etc/webapi.xml#L26\">webapi.xml</a> nodes like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber 0\" class=\"language-xml line-numbers\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>data</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parameter</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>cartId<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>%cart_id%<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parameter</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>data</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>This feature allows for the API consumers to skip passing current customer’s cart id, this is taken care of the Magento framework automatically.</p>\n<p>But how do these parameters internally work and how to add a custom one?</p>\n<p>Quick search by <code class=\"language-text\">%cart_id%</code> reveals this snippet in di.xml:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Magento\\Webapi\\Controller\\Rest\\ParamsOverrider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arguments</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>argument</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>paramOverriders<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>array<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>%cart_id%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>object<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Magento\\Quote\\Model\\Webapi\\ParamOverriderCartId\\Proxy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>argument</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>arguments</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>By looking at <code class=\"language-text\">Magento\\Quote\\Model\\Webapi\\ParamOverriderCartId\\Proxy</code> class (\\Proxy is used for lazy loading) it’s apparent that a custom parameters resolver has to implement the <code class=\"language-text\">ParamOverriderInterface</code> and this interface just a perfect example how code can be well-documented, <a href=\"https://github.com/magento/magento2/blob/2.3-develop/lib/internal/Magento/Framework/Webapi/Rest/Request/ParamOverriderInterface.php\">have a read through it</a>.</p>\n<p>The other available parameter is <code class=\"language-text\">%customer_id%</code>, in customization I worked on I introduced <code class=\"language-text\">%admin_id%</code> parameter which allows to attach custom information to admin user entity and then retrieve it without explicitly passing or knowing admin’s user id.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Magento\\Webapi\\Controller\\Rest\\ParamsOverrider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arguments</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>argument</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>paramOverriders<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>array<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>%admin_id%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>object<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Vendor\\Namespace\\Controller\\Rest\\ParamOverriderAdminId<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>argument</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>arguments</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Vendor<span class=\"token punctuation\">\\</span>Namespace<span class=\"token punctuation\">\\</span>Controller<span class=\"token punctuation\">\\</span>Rest</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Magento<span class=\"token punctuation\">\\</span>Authorization<span class=\"token punctuation\">\\</span>Model<span class=\"token punctuation\">\\</span>UserContextInterface</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Magento<span class=\"token punctuation\">\\</span>Framework<span class=\"token punctuation\">\\</span>Webapi<span class=\"token punctuation\">\\</span>Rest<span class=\"token punctuation\">\\</span>Request<span class=\"token punctuation\">\\</span>ParamOverriderInterface</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Replaces a \"%admin_id%\" value with the admin user id\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ParamOverriderAdminId</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ParamOverriderInterface</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * @var UserContextInterface\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$userContext</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @param UserContextInterface $userContext\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>UserContextInterface <span class=\"token variable\">$userContext</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">userContext</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$userContext</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * {@inheritDoc}\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getOverriddenValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">userContext</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getUserType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> UserContextInterface<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">USER_TYPE_ADMIN</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">userContext</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>New parameter can be used in <code class=\"language-text\">webapi.xml</code> as simple as:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>data</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parameter</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>userId<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>%admin_id%<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parameter</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>data</span><span class=\"token punctuation\">></span></span></code></pre></div>","frontmatter":{"title":"Web API Data Parameters","date":"April 28, 2019","description":"This post explains inner working of Web API Data Parameters and how to add a custom parameter"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/webapi-data-parameters/","previous":{"fields":{"slug":"/mage-unconference-2017/"},"frontmatter":{"title":"MageUnConference 2017 Experience"}},"next":null}}